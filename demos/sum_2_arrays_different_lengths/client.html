<html>
    <head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">

        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>

        <!-- JIFF related files -->  
        <script src="/socket.io/socket.io.js"></script>
        <script src="/lib/sodium.js"></script>
        <script src="/lib/jiff-client.js"></script>


        <script>
            "use strict";
            // Called when the connect button is clicked: connect to the server and intialize the MPC.
            function connect() {
                // Disable connect button
                $('#connectBtn').prop('disabled', true);

                // Figure out parameters to intialize the instance.
                var computation_id = 1;
                var party_count = 2;
                
                // Figure out the hostname of the server from the currently open URL.
                var hostname = window.location.hostname.trim();
                var port = window.location.port;
                if(port == null || port == '')
                    port = "8080";
                if(!(hostname.startsWith("http://") || hostname.startsWith("https://")))
                    hostname = "http://" + hostname;
                if(hostname.endsWith("/"))
                    hostname = hostname.substring(0, hostname.length-1);
                hostname = hostname + ":" + port;

                // Create an MPC instance and connect
                MPCconnect(hostname, computation_id, party_count);
            }


            var jiff_instance = null;

            // Create a JIFF instance and connect to the server.
            function MPCconnect(hostname, computation_id, party_count) {
                var options = { 'party_count': party_count };
                options.onError = function(error) { $("#result").append("<p class='error'>"+error+"</p>"); };
                options.onConnect = function() { $("#compareBtn").attr("disabled", false); $("#result").append("<p>All parties Connected!</p>"); };

                jiff_instance = jiff.make_jiff(hostname, computation_id, options);
            }

            function process() {
                var arr = JSON.parse(document.getElementById('inputText').value);
                for (var i = 0; i < arr.length; i++)
                    if (typeof arr[i] !== 'number')
                        return;

                $("#sortBtn").attr("disabled", true);

                jiff_instance.share_array(arr).then(function(r) {
                    let result;
                    for(let party in r)
                        for(let i = 0; i < r[party].length; i++)
                            result = !result ? r[party][i] : result.add(r[party][i]);
                    
                    result.open().then(function(result_opened) {
                        $('#res').append(result_opened);
                    });
                });
            }
        </script>
    </head>


    <body>
        <div class="container">
            <div class="row">
                <h1>Test Sum</h1>
            </div>
            <div>
                <p>Enter an array of positive integers. The array can have a different length from the other party's array.</p>  
            </div>
            <div class="row" id="result"></div>
            <textarea rows="4" cols="50" id="inputText">[1,3,2]</textarea>
            <div class="row">
            </div>
            <br/><br/>
            <div id="btns" class="row">
            <button class="btn btn-secondary" id="connectBtn" onclick="connect();">connect</button>
            <button class="btn btn-secondary" id="sortBtn"  onclick="process();">compare</button>
            </div>
            <br/>
            <div class="row">
                <h4 id="res">Result = </h4>
            </div>
        </div>
    </body>
</html>

