<html>
  <head>
    <title>Sum integers under MPC</title>
    <style>
      .error {
        color: #FF0000;
      }
    </style>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/lib/sodium.js"></script>
    <script src="/lib/jiff-client.js"></script>
    <script type="text/javascript">
      var jiff_instance;

      function connect() {
        $('#connectButton').prop('disabled', true);
        var computation_id = $('#computation_id').val();
        var party_count = parseInt($('#count').val());


        var options = {party_count:2};
        options.onError = function(error) { $("#output").append("<p class='error'>"+error+"</p>"); };
        options.onConnect = function() { $("#submit").attr("disabled", false); $("#output").append("<p>All parties Connected!</p>"); };
        
        var hostname = window.location.hostname.trim();
        var port = window.location.port;
        if(port == null || port == '') 
        port = "80";
        if(!(hostname.startsWith("http://") || hostname.startsWith("https://")))
        hostname = "http://" + hostname;
        if(hostname.endsWith("/"))
        hostname = hostname.substring(0, hostname.length-1);
        if(hostname.indexOf(":") > -1)
        hostanme = hostname.substring(0, hostname.indexOf(":"));

        hostname = hostname + ":" + port;
        jiff_instance = jiff.make_jiff(hostname, computation_id, options);
        
      }

      function submit() {
        var input = $('input[name=choice]:checked').val() == 'yes' ? true : false;
        $("#sumButton").attr("disabled", true);
        $("#output").append("<p>Starting...</p>");
        var shares = jiff_instance.share(input);
        let result = shares[1].smult(shares[2]);
        result.open(handleResult);          
      }

      function handleResult(result) {
        $("#output").append("<p>Result is: " + result + "</p>");
        $("#sumButton").attr("disabled", false);
      }
    </script>
  </head>
  <body>
    <h1>Connect JIFF</h1>
    <label for="computation_id">Computation ID</label><input id="computation_id" value="test"></input>
    <br/><br/>
    <button id="connectButton" onclick="connect();">Connect</button>
    <br/><br/>
    <hr/>
    <input type="radio" id="c1" name="choice" value="yes">
    <label for="c1">Yes</label>
    <input type="radio" id="c2" name="choice" value="no">
    <label for="c2">No</label>
    <button onclick="submit();" disabled="disabled" id="submit">Submit</button><br/>

    <div id="output"></div>
  </body>
</html>
